<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/>
<title>120! v26</title>
<style>
  :root{
    --bg:#0f1420; --tile-on:#3ec7c2; --tile-off:#2a3550;
    --ink:#e8eef8; --muted:#9fb3c8; --digit-ink:#e7f0ff;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial;
    display:flex; flex-direction:column; align-items:center;
    -webkit-tap-highlight-color: transparent;
  }
  h1{font-size:18px; font-weight:700; margin:10px 0 8px}
  #frame{display:flex; flex-direction:column; align-items:center}
  .hud{width:100%; box-sizing:border-box; display:flex; flex-direction:column; gap:6px; color:var(--muted); font-size:20px; padding:0 4px;}
  .row{display:flex; align-items:baseline; gap:8px; min-width:0}
  .row .label{white-space:nowrap}
  #boardsHex{display:block; width:100%; overflow-x:auto; white-space:nowrap; padding-bottom:2px; border-bottom:1px dashed rgba(231,240,255,0.2);}
  canvas{display:block; position:relative}
  .bar{width:100%; display:flex; justify-content:center; gap:10px}
  button{
    margin:12px 0 14px; padding:12px 18px; border:none; border-radius:12px;
    background:var(--tile-off); color:var(--digit-ink); font-size:16px; font-weight:700;
    touch-action:manipulation; user-select:none; min-width:120px;
  }
  .btn-on{ background:var(--tile-on)!important; color:#0a1320!important; }
  @media (max-width:420px){ .hud{font-size:18px; gap:5px; padding:0 2px} h1{font-size:16px} button{font-size:15px} }
  .hud, .hud .label, #onCount, #total, #boardsHex .real { color: var(--ink); font-weight:700; }
</style>
</head>
<body>
<h1>120! v26</h1>
<div id="frame">
  <div class="hud" id="hud">
    <div class="row"><span class="label">On:</span> <b id="onCount">0</b>/<b id="total">120</b></div>
    <div class="row">
      <span class="label">Boards:</span>
      <div aria-label="12×10 kapcsolgatható rács, decimális Board-számlálóval" id="boardsHex"><span class="real">0</span></div>
    </div>
  </div>
  <canvas aria-label="12×10 kapcsolgatható rács, decimális Board-számlálóval" id="stage"></canvas>
  <div class="bar">
    <button aria-pressed="false" id="eraseA">Number 1</button>
    <button aria-pressed="false" id="eraseB">Number 2</button>
  </div>
</div>

<script>
(()=> {
  const COLS=12, ROWS=10, TOTAL=COLS*ROWS;            // 120
  const LABEL_A='Number 1', LABEL_B='Number 2';

  const DPR=Math.max(1, Math.min(window.devicePixelRatio||1, 2));
  const canvas=document.getElementById('stage');
  const ctx=canvas.getContext('2d');
  const css=v=>getComputedStyle(document.documentElement).getPropertyValue(v).trim();
  const COLORS={ BG:css('--bg'), ON:css('--tile-on'), OFF:css('--tile-off'), INK:css('--ink'), DIGIT_INK:css('--digit-ink') };

  const grid={ cols:COLS, rows:ROWS, size:0, pad:10 };
  let matrix=[], onCount=0, boards="0", locked=false, activeErase=0;

  const elOn=document.getElementById('onCount');
  const elBoardsHex=document.getElementById('boardsHex');
  const hud=document.getElementById('hud');
  const frame=document.getElementById('frame');
  const btnA=document.getElementById('eraseA');
  const btnB=document.getElementById('eraseB');
  btnA.textContent=LABEL_A; btnB.textContent=LABEL_B;

  const STORAGE_KEY='120v26_12x10_dualToggle_state';

  function fitCanvas(){
    const outer=18, h1=document.querySelector('h1'), bar=document.querySelector('.bar');
    const h1H=h1?h1.getBoundingClientRect().height:0;
    const hudH=hud?hud.getBoundingClientRect().height:0;
    const barH=bar?bar.getBoundingClientRect().height:0;
    const safetyY=18;

    const maxW=Math.max(320, window.innerWidth-outer*2);
    const maxH=Math.max(260, window.innerHeight-(h1H+hudH+barH+safetyY+outer*2));

    grid.pad=Math.round(Math.max(10, Math.min(18, Math.min(maxW,maxH)*0.025)));
    const sizeFromW=Math.floor((maxW-(grid.pad*(grid.cols+1)))/grid.cols);
    const sizeFromH=Math.floor((maxH-(grid.pad*(grid.rows+1)))/grid.rows);

    const MAX_TILE=Math.min(88, Math.floor(window.innerWidth/7));
    grid.size=Math.min(MAX_TILE, Math.max(18, Math.min(sizeFromW,sizeFromH)));

    const cssW=grid.cols*(grid.size+grid.pad)+grid.pad;
    const cssH=grid.rows*(grid.size+grid.pad)+grid.pad;

    frame.style.width=cssW+'px';
    canvas.style.width=cssW+'px';
    canvas.style.height=cssH+'px';
    canvas.width=Math.round(cssW*DPR);
    canvas.height=Math.round(cssH*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
    draw();
  }

  function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify({matrix,onCount,boards,activeErase})); }catch(e){} }
  function loadState(){
    try{
      const s=localStorage.getItem(STORAGE_KEY);
      if(s){
        const st=JSON.parse(s);
        if(st.matrix && st.matrix.length===grid.rows && st.matrix[0].length===grid.cols){
          matrix=st.matrix; onCount=st.onCount||0; boards=st.boards||"0"; activeErase=st.activeErase||0; return true;
        }
      }
    }catch(e){ localStorage.removeItem(STORAGE_KEY); }
    return false;
  }

  function initMatrix(){
    if(!loadState()){ matrix=Array.from({length:grid.rows},()=>Array(grid.cols).fill(false)); onCount=0; boards="0"; activeErase=0; }
    locked=(onCount===TOTAL);
    syncHUD(); renderErase(); draw();
  }

  function rr(x,y,w,h,r){ const a=Math.min(r,w/2,h/2);
    ctx.beginPath(); ctx.moveTo(x+a,y); ctx.arcTo(x+w,y,x+w,y+h,a);
    ctx.arcTo(x+w,y+h,x,y+h,a); ctx.arcTo(x,y+h,x,y,a); ctx.arcTo(x,y,x+w,y,a); ctx.closePath();
  }
  function drawHex(cx,cy,txt,isOn){
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.font='700 '+Math.max(12,Math.floor(grid.size*0.36))+'px Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial';
    ctx.fillStyle=isOn?'#0a1320':COLORS.DIGIT_INK;
    ctx.fillText(txt,cx,cy);
  }
  function draw(){
    ctx.fillStyle=COLORS.BG; ctx.fillRect(0,0,canvas.width/DPR,canvas.height/DPR);
    for(let r=0;r<grid.rows;r++){
      for(let c=0;c<grid.cols;c++){
        const idx=r*grid.cols+c, hex=idx.toString(16).toUpperCase().padStart(2,'0');
        const x=c*(grid.size+grid.pad)+grid.pad, y=r*(grid.size+grid.pad)+grid.pad;
        rr(x,y,grid.size,grid.size,10);
        const on=matrix[r][c]; ctx.fillStyle=on?COLORS.ON:COLORS.OFF; ctx.fill();
        drawHex(x+grid.size/2, y+grid.size/2, hex, on);
      }
    }
  }

  function bigAdd(a,b){
    let res='',carry=0,i=a.length-1,j=b.length-1;
    while(i>=0||j>=0||carry){
      const da=i>=0?(a.charCodeAt(i)-48):0;
      const db=j>=0?(b.charCodeAt(j)-48):0;
      const s=da+db+carry; res=(s%10)+res; carry=(s/10)|0; i--; j--;
    }
    let k=0; while(k<res.length-1 && res[k]==='0') k++; 
    return res.slice(k);
  }

  function renderBoardsDisplay(v){
    elBoardsHex.innerHTML='<span class="real">'+v+'</span>';
    requestAnimationFrame(()=>{ elBoardsHex.scrollLeft=elBoardsHex.scrollWidth; });
  }
  function syncHUD(){ elOn.textContent=String(onCount); document.getElementById('total').textContent=String(TOTAL); renderBoardsDisplay(boards); saveState(); }

  function toggleCell(r,c){
    if(locked) return;
    matrix[r][c]=!matrix[r][c];
    onCount += matrix[r][c] ? 1 : -1;
    syncHUD(); draw();
  }

  function pointerXY(e){ const rect=canvas.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top; return {x,y}; }
  function toggleAt(x,y){
    if(locked) return;
    for(let r=0;r<grid.rows;r++){
      for(let c=0;c<grid.cols;c++){
        const cx=c*(grid.size+grid.pad)+grid.pad, cy=r*(grid.size+grid.pad)+grid.pad;
        if(x>=cx && x<=cx+grid.size && y>=cy && y<=cy+grid.size){ toggleCell(r,c); return; }
      }
    }
  }

  canvas.addEventListener('click', e=>{ const p=pointerXY(e); toggleAt(p.x,p.y); });
  let touchMoved=false;
  canvas.addEventListener('touchstart', ()=>{ touchMoved=false; }, {passive:true});
  canvas.addEventListener('touchmove',  ()=>{ touchMoved=true;  }, {passive:true});
  canvas.addEventListener('touchend',   e=>{ if(!touchMoved){ const p=pointerXY(e); toggleAt(p.x,p.y); } }, {passive:true});

  function renderErase(){ 
    btnA.classList.toggle('btn-on',activeErase===1); 
    btnB.classList.toggle('btn-on',activeErase===2); 
    btnA.setAttribute('aria-pressed',String(activeErase===1)); 
    btnB.setAttribute('aria-pressed',String(activeErase===2)); 
  }

  // v26: buttons DO NOT clear; each press increases Boards by +1 and toggles visual state
  function pressButton(which){
    boards = bigAdd(boards, '1');   // increment counter
    activeErase = (activeErase===which) ? 0 : which; // toggle visual
    syncHUD(); 
    renderErase(); 
    saveState();
  }
  btnA.addEventListener('click',()=>pressButton(1));
  btnB.addEventListener('click',()=>pressButton(2));

  function refitAll(){ fitCanvas(); }
  window.addEventListener('resize', refitAll);
  window.addEventListener('orientationchange', refitAll);
  const ro=new ResizeObserver(()=>refitAll()); ro.observe(hud); ro.observe(elBoardsHex);
  if(document.fonts && document.fonts.ready){ document.fonts.ready.then(()=>refitAll()); }

  initMatrix(); refitAll();
  requestAnimationFrame(refitAll);
  setTimeout(refitAll,0); setTimeout(refitAll,50); setTimeout(refitAll,150);
})();
</script>
</body>
</html>
